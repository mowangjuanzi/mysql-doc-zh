import{_ as s,o as a,c as l,U as n}from"./chunks/framework.76b79cb5.js";const D=JSON.parse('{"title":"3.5 在批处理模式使用 mysql","description":"","frontmatter":{},"headers":[],"relativePath":"zh/batch-mode.md","filePath":"zh/batch-mode.md"}'),p={name:"zh/batch-mode.md"},e=n(`<h1 id="_3-5-在批处理模式使用-mysql" tabindex="-1">3.5 在批处理模式使用 mysql <a class="header-anchor" href="#_3-5-在批处理模式使用-mysql" aria-label="Permalink to &quot;3.5 在批处理模式使用 mysql&quot;">​</a></h1><p>在前几节, 你使用交互式 <a href="./mysql.html"><code>mysql</code></a> 输入语句并查看结果. 你也可以在批处理模式中使用 <a href="./mysql.html"><code>mysql</code></a>. 要做到这一点, 把你想要运行的语句放在一个语句中, 然后告诉 <a href="./mysql.html"><code>mysql</code></a> 从文件中读取:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch-file</span></span></code></pre></div><p>如果你在 Windows 中运行 <a href="./mysql.html"><code>mysql</code></a>, 并且文件中有一些特殊字符可能会导致问题, 你可以这样做:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">C:\\&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">source batch-file</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>如果你需要在命令上指定连接参数, 命令可能如下所示:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-h</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">host</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">user</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch-file</span></span>
<span class="line"><span style="color:#FFCB6B;">Enter</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">password:</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">********</span></span></code></pre></div><p>当你以这种方式使用 <a href="./mysql.html"><code>mysql</code></a> 时, 你可以创建一个脚本文件, 然后执行该脚本.</p><p>如果运行的脚本中一些语句产生了错误, 你应该使用 <a href="./mysql-command-options.html#option_mysql_force"><code>--force</code></a> 命令行选项.</p><p>为什么要使用脚本? 原因如下:</p><ul><li><p>如果你想重复运行一个查询 (例如每天或者每周), 那么将它作为脚本可以使你避免在每次执行查询时重新输入它.</p></li><li><p>你可以通过复制和编辑脚本, 从现有的脚本中生成新的脚本.</p></li><li><p>在开发查询时, 批处理模式非常有用, 特别时对于多行语句或者多语句序列. 如果你犯了一个错误, 你不需要重新输入所有的东西. 仅需要编辑你的脚本来纠正错误, 然后告诉 <a href="./mysql.html"><code>mysql</code></a> 再次执行它.</p></li><li><p>如果你有一个查询产生了大量的输出, 你可以通过 paper 来运行输出而不是看着它从你的屏幕顶部滚动:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch-file</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">more</span></span></code></pre></div></li><li><p>你也可以从文件中捕获输出, 以便进一步处理</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch-file</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql.out</span></span></code></pre></div></li><li><p>你也可以将脚本发给其他人, 以便其他人运行查询.</p></li><li><p>有些情况不允许交互式操作, 例如, 当你从 <code>cron</code> 运行查询时. 在这种情况下, 必须使用批处理程序.</p></li></ul><p>当以批处理模式运行 <a href="./mysql.html"><code>mysql</code></a> 时, 默认的输出格式与交互式使用时不同(更简洁). 例如, 当 <a href="./mysql.html"><code>mysql</code></a> 交互式运行时, <code>SELECT DISTINCT species FROM pet</code> 的 输出如下:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">+</span><span style="color:#676E95;font-style:italic;">---------+</span></span>
<span class="line"><span style="color:#A6ACCD;">| species |</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#676E95;font-style:italic;">---------+</span></span>
<span class="line"><span style="color:#A6ACCD;">| bird    |</span></span>
<span class="line"><span style="color:#A6ACCD;">| cat     |</span></span>
<span class="line"><span style="color:#A6ACCD;">| dog     |</span></span>
<span class="line"><span style="color:#A6ACCD;">| hamster |</span></span>
<span class="line"><span style="color:#A6ACCD;">| snake   |</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#676E95;font-style:italic;">---------+</span></span></code></pre></div><p>在批处理模式下, 输出看起来是这样的:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">species</span></span>
<span class="line"><span style="color:#A6ACCD;">bird</span></span>
<span class="line"><span style="color:#A6ACCD;">cat</span></span>
<span class="line"><span style="color:#A6ACCD;">dog</span></span>
<span class="line"><span style="color:#A6ACCD;">hamster</span></span>
<span class="line"><span style="color:#A6ACCD;">snake</span></span></code></pre></div><p>如果希望以批处理模式获得交互式输出格式, 使用 <a href="./mysql.html"><code>mysql -t</code></a>. 输出执行的语句, 使用 <a href="./mysql.html"><code>mysql -v</code></a>.</p><p>你也可以使用 <code>source</code> 命令或者 <code>\\.</code> 命令从 <a href="./mysql.html"><code>mysql</code></a> 提示符中使用脚本:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">mysql</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> source </span><span style="color:#F78C6C;">filename</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">mysql</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> \\. </span><span style="color:#F78C6C;">filename</span></span></code></pre></div><p>参阅 <a href="./mysql-batch-commands.html">Section 4.5.1.5, “从文本文件中执行 SQL 语句”</a>获取更多信息.</p>`,19),o=[e];function t(c,r,y,C,i,d){return a(),l("div",null,o)}const m=s(p,[["render",t]]);export{D as __pageData,m as default};
